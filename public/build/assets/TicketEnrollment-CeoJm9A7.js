import{d as te,G as oe,g as q,I as Z,c as d,i as ie,b as e,j as u,e as $,v as p,q as R,F as U,n as T,k as x,a as S,B as C,T as B,w as H,t as I,o as i,r as h,f as de,z as ue,J as ce,A as pe,u as F,h as me,m as fe,l as _,s as ge,x as ye}from"./app-BbDXI_Od.js";import{B as be}from"./BrowserQRCodeReader-lwVMlZcW.js";import{_ as ve}from"./AppLayout.vue_vue_type_script_setup_true_lang-D1uJhlkX.js";import"./lazy-CSzc0j1S.js";const xe={class:"enroll-card"},qe={class:"enroll-grid"},ke=["readonly"],Ie=["value"],we=["value"],he={class:"sm:col-span-2 xl:col-span-4"},Ue={key:0,class:"mt-2 flex flex-wrap gap-2 text-xs text-muted-foreground"},Se={class:"space-y-4"},De={class:"enroll-card"},Te={class:"enroll-toggle-grid"},Ae={class:"enroll-toggle"},Me={class:"enroll-toggle"},$e={class:"enroll-toggle"},He={class:"enroll-toggle"},Re={key:0,class:"enroll-panel"},Ve={class:"enroll-grid enroll-grid--tight"},Oe={key:0,class:"enroll-panel"},Le={class:"enroll-grid enroll-grid--tight"},Ee=["value"],Ne={key:0,class:"enroll-panel"},Ce={class:"enroll-grid enroll-grid--tight"},Be=["value"],je={class:"sm:col-span-2 lg:col-span-3"},Pe=["value"],We={key:0,class:"enroll-panel"},Fe={class:"enroll-grid enroll-grid--tight"},Qe={class:"sm:col-span-2"},ee=te({__name:"TicketEnrollmentForm",props:{scannedId:{},readonlyId:{type:Boolean},initial:{},natureOptions:{},referenceOptions:{}},emits:["submit"],setup(j,{emit:o}){const b=j,P=o,n=oe({uniqueId:"",equipmentName:"",equipmentType:"",brand:"",model:"",serialNumber:"",assetTag:"",supplier:"",purchaseDate:"",expiryDate:"",warrantyStatus:"",equipmentImageUrls:[],equipmentImages:[],specification:{memory:"",storage:"",operatingSystem:"",networkAddress:"",accessories:""},locationAssignment:{assignedTo:"",officeDivision:"",dateIssued:""},requestHistory:{natureOfRequest:"",date:"",actionTaken:"",assignedStaff:"",remarks:""},scheduledMaintenance:{date:"",remarks:""},sections:{specification:!1,locationAssignment:!1,requestHistory:!1,scheduledMaintenance:!1}}),V=q(()=>!!(b.readonlyId&&b.scannedId)),y=q(()=>{const l=(b.natureOptions??[]).map(v=>({...v,isLegacy:!1})),t=n.requestHistory.natureOfRequest?.trim();return!t||l.some(v=>v.name===t)?l:[{id:-1,name:t,isLegacy:!0},...l]});function k(l,t){const s=t?.trim();return s?l.some(g=>g.name===s)?l.map(g=>({...g,isLegacy:!1})):[{id:-1,name:s,isLegacy:!0},...l.map(g=>({...g,isLegacy:!1}))]:l.map(g=>({...g,isLegacy:!1}))}const A=q(()=>k(b.referenceOptions?.category??[],n.equipmentType)),f=q(()=>k(b.referenceOptions?.status??[],n.warrantyStatus)),M=q(()=>k(b.referenceOptions?.officeDesignation??[],n.locationAssignment.officeDivision)),w=q(()=>k(b.referenceOptions?.remarks??[],n.requestHistory.remarks));Z(()=>b.scannedId,l=>{n.uniqueId=l},{immediate:!0}),Z(()=>b.initial,l=>{if(!l)return;n.uniqueId=l.uniqueId??n.uniqueId,n.equipmentName=l.equipmentName??n.equipmentName,n.equipmentType=l.equipmentType??n.equipmentType,n.brand=l.brand??n.brand,n.model=l.model??n.model,n.serialNumber=l.serialNumber??n.serialNumber,n.assetTag=l.assetTag??n.assetTag,n.supplier=l.supplier??n.supplier,n.purchaseDate=l.purchaseDate??n.purchaseDate,n.expiryDate=l.expiryDate??n.expiryDate,n.warrantyStatus=l.warrantyStatus??n.warrantyStatus,n.equipmentImageUrls=l.equipmentImageUrls??n.equipmentImageUrls,n.specification={...n.specification,...l.specification},n.locationAssignment={...n.locationAssignment,...l.locationAssignment},n.requestHistory={...n.requestHistory,...l.requestHistory},n.scheduledMaintenance={...n.scheduledMaintenance,...l.scheduledMaintenance};const t=!!(l.specification?.memory||l.specification?.storage||l.specification?.operatingSystem||l.specification?.networkAddress||l.specification?.accessories),s=!!(l.locationAssignment?.assignedTo||l.locationAssignment?.officeDivision||l.locationAssignment?.dateIssued),v=!!(l.requestHistory?.natureOfRequest||l.requestHistory?.date||l.requestHistory?.actionTaken||l.requestHistory?.assignedStaff||l.requestHistory?.remarks),g=!!(l.scheduledMaintenance?.date||l.scheduledMaintenance?.remarks);n.sections={specification:l.sections?.specification??t,locationAssignment:l.sections?.locationAssignment??s,requestHistory:l.sections?.requestHistory??v,scheduledMaintenance:l.sections?.scheduledMaintenance??g}},{immediate:!0});function D(){P("submit",{...n})}return(l,t)=>(i(),d("form",{class:"enroll-form space-y-6",onSubmit:ie(D,["prevent"])},[e("section",xe,[t[46]||(t[46]=e("div",{class:"enroll-section-header"},[e("div",null,[e("h3",{class:"enroll-title"},"Identification"),e("p",{class:"enroll-subtitle"},"Required fields first")]),e("span",{class:"enroll-badge"},"Asset details")],-1)),e("div",qe,[e("div",null,[t[31]||(t[31]=e("label",{class:"enroll-label"},[$(" Unique ID "),e("span",{class:"enroll-required"},"*")],-1)),u(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>n.uniqueId=s),type:"text",readonly:V.value,class:"enroll-input",placeholder:"MIS-UID-00000",pattern:"MIS-UID-[0-9]{5}"},null,8,ke),[[p,n.uniqueId]])]),e("div",null,[t[32]||(t[32]=e("label",{class:"enroll-label"},[$(" Equipment Name "),e("span",{class:"enroll-required"},"*")],-1)),u(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>n.equipmentName=s),type:"text",required:"",class:"enroll-input",placeholder:"Laptop, printer, router"},null,512),[[p,n.equipmentName]])]),e("div",null,[t[34]||(t[34]=e("label",{class:"enroll-label"},[$(" Equipment Type "),e("span",{class:"enroll-required"},"*")],-1)),u(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>n.equipmentType=s),required:"",class:"enroll-input"},[t[33]||(t[33]=e("option",{value:"",disabled:""},"Select a category",-1)),(i(!0),d(U,null,T(A.value,s=>(i(),d("option",{key:s.isLegacy?`legacy-${s.name}`:s.id,value:s.name},I(s.isLegacy?`${s.name} (inactive)`:s.name),9,Ie))),128))],512),[[R,n.equipmentType]])]),e("div",null,[t[35]||(t[35]=e("label",{class:"enroll-label"},[$(" Brand/Manufacturer "),e("span",{class:"enroll-required"},"*")],-1)),u(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>n.brand=s),type:"text",required:"",class:"enroll-input",placeholder:"Dell, HP, Cisco"},null,512),[[p,n.brand]])]),e("div",null,[t[36]||(t[36]=e("label",{class:"enroll-label"},[$(" Model/Series "),e("span",{class:"enroll-required"},"*")],-1)),u(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>n.model=s),type:"text",required:"",class:"enroll-input",placeholder:"Model number"},null,512),[[p,n.model]])]),e("div",null,[t[37]||(t[37]=e("label",{class:"enroll-label"},"Serial Number",-1)),u(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>n.serialNumber=s),type:"text",class:"enroll-input",placeholder:"SN-0000"},null,512),[[p,n.serialNumber]])]),e("div",null,[t[38]||(t[38]=e("label",{class:"enroll-label"},"Property/Asset Tag No.",-1)),u(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>n.assetTag=s),type:"text",class:"enroll-input",placeholder:"TAG-0000"},null,512),[[p,n.assetTag]])]),e("div",null,[t[39]||(t[39]=e("label",{class:"enroll-label"},"Supplier",-1)),u(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>n.supplier=s),type:"text",class:"enroll-input",placeholder:"Vendor name"},null,512),[[p,n.supplier]])]),e("div",null,[t[40]||(t[40]=e("label",{class:"enroll-label"},"Purchase Date",-1)),u(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>n.purchaseDate=s),type:"date",class:"enroll-input"},null,512),[[p,n.purchaseDate]])]),e("div",null,[t[41]||(t[41]=e("label",{class:"enroll-label"},"Expiry Date",-1)),u(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>n.expiryDate=s),type:"date",class:"enroll-input"},null,512),[[p,n.expiryDate]])]),e("div",null,[t[43]||(t[43]=e("label",{class:"enroll-label"},"Warranty Status",-1)),u(e("select",{"onUpdate:modelValue":t[10]||(t[10]=s=>n.warrantyStatus=s),class:"enroll-input"},[t[42]||(t[42]=e("option",{value:""},"Select a status",-1)),(i(!0),d(U,null,T(f.value,s=>(i(),d("option",{key:s.isLegacy?`legacy-${s.name}`:s.id,value:s.name},I(s.isLegacy?`${s.name} (inactive)`:s.name),9,we))),128))],512),[[R,n.warrantyStatus]])]),e("div",he,[t[44]||(t[44]=e("label",{class:"enroll-label"},"Equipment Images/Pictures",-1)),e("input",{type:"file",class:"enroll-input",accept:"image/*",multiple:"",capture:"environment",onChange:t[11]||(t[11]=s=>n.equipmentImages=Array.from(s.target.files||[]))},null,32),t[45]||(t[45]=e("p",{class:"enroll-footnote"}," Upload or take multiple photos. Existing files remain unless replaced. ",-1)),n.equipmentImageUrls.length?(i(),d("div",Ue,[(i(!0),d(U,null,T(n.equipmentImageUrls,(s,v)=>(i(),d("span",{key:`image-${v}`,class:"rounded-full border border-sidebar-border/60 px-3 py-1"},I(s),1))),128))])):x("",!0)])])]),e("section",Se,[e("div",De,[t[51]||(t[51]=e("div",{class:"enroll-section-header"},[e("div",null,[e("h4",{class:"enroll-title"},"Optional sections"),e("p",{class:"enroll-subtitle"}," Include the details that apply to this asset. ")]),e("span",{class:"enroll-badge"},"Include this section")],-1)),e("div",Te,[e("label",Ae,[u(e("input",{"onUpdate:modelValue":t[12]||(t[12]=s=>n.sections.specification=s),type:"checkbox",class:"enroll-checkbox"},null,512),[[C,n.sections.specification]]),t[47]||(t[47]=e("span",null,"Specification",-1))]),e("label",Me,[u(e("input",{"onUpdate:modelValue":t[13]||(t[13]=s=>n.sections.locationAssignment=s),type:"checkbox",class:"enroll-checkbox"},null,512),[[C,n.sections.locationAssignment]]),t[48]||(t[48]=e("span",null,"Location & Assignment",-1))]),e("label",$e,[u(e("input",{"onUpdate:modelValue":t[14]||(t[14]=s=>n.sections.requestHistory=s),type:"checkbox",class:"enroll-checkbox"},null,512),[[C,n.sections.requestHistory]]),t[49]||(t[49]=e("span",null,"Request History",-1))]),e("label",He,[u(e("input",{"onUpdate:modelValue":t[15]||(t[15]=s=>n.sections.scheduledMaintenance=s),type:"checkbox",class:"enroll-checkbox"},null,512),[[C,n.sections.scheduledMaintenance]]),t[50]||(t[50]=e("span",null,"Scheduled Maintenance",-1))])])]),S(B,{name:"enroll-fade"},{default:H(()=>[n.sections.specification?(i(),d("section",Re,[t[57]||(t[57]=e("div",{class:"enroll-section-header"},[e("h4",{class:"enroll-title"},"Specification"),e("span",{class:"enroll-badge"},"Hardware details")],-1)),e("div",Ve,[e("div",null,[t[52]||(t[52]=e("label",{class:"enroll-label"},"Memory (RAM)",-1)),u(e("input",{"onUpdate:modelValue":t[16]||(t[16]=s=>n.specification.memory=s),type:"text",class:"enroll-input",placeholder:"16 GB"},null,512),[[p,n.specification.memory]])]),e("div",null,[t[53]||(t[53]=e("label",{class:"enroll-label"},"Storage",-1)),u(e("input",{"onUpdate:modelValue":t[17]||(t[17]=s=>n.specification.storage=s),type:"text",class:"enroll-input",placeholder:"512 GB SSD"},null,512),[[p,n.specification.storage]])]),e("div",null,[t[54]||(t[54]=e("label",{class:"enroll-label"},"Operating System",-1)),u(e("input",{"onUpdate:modelValue":t[18]||(t[18]=s=>n.specification.operatingSystem=s),type:"text",class:"enroll-input",placeholder:"Windows 11"},null,512),[[p,n.specification.operatingSystem]])]),e("div",null,[t[55]||(t[55]=e("label",{class:"enroll-label"},"Network/IP Address",-1)),u(e("input",{"onUpdate:modelValue":t[19]||(t[19]=s=>n.specification.networkAddress=s),type:"text",class:"enroll-input",placeholder:"10.0.0.12"},null,512),[[p,n.specification.networkAddress]])]),e("div",null,[t[56]||(t[56]=e("label",{class:"enroll-label"},"Accessories Included",-1)),u(e("input",{"onUpdate:modelValue":t[20]||(t[20]=s=>n.specification.accessories=s),type:"text",class:"enroll-input",placeholder:"Dock, charger, mouse"},null,512),[[p,n.specification.accessories]])])])])):x("",!0)]),_:1}),S(B,{name:"enroll-fade"},{default:H(()=>[n.sections.locationAssignment?(i(),d("section",Oe,[t[62]||(t[62]=e("div",{class:"enroll-section-header"},[e("h4",{class:"enroll-title"},"Location & Assignment"),e("span",{class:"enroll-badge"},"Issuance info")],-1)),e("div",Le,[e("div",null,[t[58]||(t[58]=e("label",{class:"enroll-label"},"Assigned To",-1)),u(e("input",{"onUpdate:modelValue":t[21]||(t[21]=s=>n.locationAssignment.assignedTo=s),type:"text",class:"enroll-input",placeholder:"Staff name"},null,512),[[p,n.locationAssignment.assignedTo]])]),e("div",null,[t[60]||(t[60]=e("label",{class:"enroll-label"},"Office/Division",-1)),u(e("select",{"onUpdate:modelValue":t[22]||(t[22]=s=>n.locationAssignment.officeDivision=s),class:"enroll-input"},[t[59]||(t[59]=e("option",{value:""},"Select an office",-1)),(i(!0),d(U,null,T(M.value,s=>(i(),d("option",{key:s.isLegacy?`legacy-${s.name}`:s.id,value:s.name},I(s.isLegacy?`${s.name} (inactive)`:s.name),9,Ee))),128))],512),[[R,n.locationAssignment.officeDivision]])]),e("div",null,[t[61]||(t[61]=e("label",{class:"enroll-label"},"Date Issued",-1)),u(e("input",{"onUpdate:modelValue":t[23]||(t[23]=s=>n.locationAssignment.dateIssued=s),type:"date",class:"enroll-input"},null,512),[[p,n.locationAssignment.dateIssued]])])])])):x("",!0)]),_:1}),S(B,{name:"enroll-fade"},{default:H(()=>[n.sections.requestHistory?(i(),d("section",Ne,[t[70]||(t[70]=e("div",{class:"enroll-section-header"},[e("h4",{class:"enroll-title"},"Request History"),e("span",{class:"enroll-badge"},"Service log")],-1)),e("div",Ce,[e("div",null,[t[64]||(t[64]=e("label",{class:"enroll-label"},"Nature of Request",-1)),u(e("select",{"onUpdate:modelValue":t[24]||(t[24]=s=>n.requestHistory.natureOfRequest=s),class:"enroll-input"},[t[63]||(t[63]=e("option",{value:"",disabled:""},"Select a request type",-1)),(i(!0),d(U,null,T(y.value,s=>(i(),d("option",{key:s.isLegacy?`legacy-${s.name}`:s.id,value:s.name},I(s.isLegacy?`${s.name} (inactive)`:s.name),9,Be))),128))],512),[[R,n.requestHistory.natureOfRequest]])]),e("div",null,[t[65]||(t[65]=e("label",{class:"enroll-label"},"Date",-1)),u(e("input",{"onUpdate:modelValue":t[25]||(t[25]=s=>n.requestHistory.date=s),type:"date",class:"enroll-input"},null,512),[[p,n.requestHistory.date]])]),e("div",null,[t[66]||(t[66]=e("label",{class:"enroll-label"},"Action Taken",-1)),u(e("input",{"onUpdate:modelValue":t[26]||(t[26]=s=>n.requestHistory.actionTaken=s),type:"text",class:"enroll-input",placeholder:"Updated firmware"},null,512),[[p,n.requestHistory.actionTaken]])]),e("div",null,[t[67]||(t[67]=e("label",{class:"enroll-label"},"Assigned IT Staff",-1)),u(e("input",{"onUpdate:modelValue":t[27]||(t[27]=s=>n.requestHistory.assignedStaff=s),type:"text",class:"enroll-input",placeholder:"Technician name"},null,512),[[p,n.requestHistory.assignedStaff]])]),e("div",je,[t[69]||(t[69]=e("label",{class:"enroll-label"},"Remarks/Recommendation",-1)),u(e("select",{"onUpdate:modelValue":t[28]||(t[28]=s=>n.requestHistory.remarks=s),class:"enroll-input"},[t[68]||(t[68]=e("option",{value:""},"Select a remark",-1)),(i(!0),d(U,null,T(w.value,s=>(i(),d("option",{key:s.isLegacy?`legacy-${s.name}`:s.id,value:s.name},I(s.isLegacy?`${s.name} (inactive)`:s.name),9,Pe))),128))],512),[[R,n.requestHistory.remarks]])])])])):x("",!0)]),_:1}),S(B,{name:"enroll-fade"},{default:H(()=>[n.sections.scheduledMaintenance?(i(),d("section",We,[t[73]||(t[73]=e("div",{class:"enroll-section-header"},[e("h4",{class:"enroll-title"},"Scheduled Maintenance"),e("span",{class:"enroll-badge"},"Upcoming work")],-1)),e("div",Fe,[e("div",null,[t[71]||(t[71]=e("label",{class:"enroll-label"},"Date",-1)),u(e("input",{"onUpdate:modelValue":t[29]||(t[29]=s=>n.scheduledMaintenance.date=s),type:"date",class:"enroll-input"},null,512),[[p,n.scheduledMaintenance.date]])]),e("div",Qe,[t[72]||(t[72]=e("label",{class:"enroll-label"},"Remarks/Recommendation",-1)),u(e("input",{"onUpdate:modelValue":t[30]||(t[30]=s=>n.scheduledMaintenance.remarks=s),type:"text",class:"enroll-input",placeholder:"Upcoming tasks"},null,512),[[p,n.scheduledMaintenance.remarks]])])])])):x("",!0)]),_:1})]),t[74]||(t[74]=e("div",{class:"enroll-footer"},[e("button",{type:"submit",class:"enroll-submit"},"Save enrollment"),e("p",{class:"enroll-footnote"},"Sections remain hidden until enabled.")],-1))],32))}}),Ge={class:"flex flex-1 flex-col gap-6 p-6"},ze={class:"enroll-hero rounded-3xl border border-sidebar-border/60 p-6"},Je={class:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between"},Ke={class:"space-y-2"},Xe={class:"text-2xl font-semibold"},Ye={class:"flex flex-wrap gap-3"},Ze={key:0,class:"grid gap-6 lg:grid-cols-[360px_1fr]"},_e={class:"enroll-side rounded-3xl border border-sidebar-border/60 p-5"},et={class:"mt-5 rounded-2xl border border-sidebar-border/70 bg-muted/30 p-4"},tt={class:"flex items-center justify-between"},st={key:0,class:"rounded-full bg-emerald-100 px-2 py-1 text-xs font-semibold text-emerald-700"},nt={key:1,class:"rounded-full bg-slate-100 px-2 py-1 text-xs font-semibold text-slate-600"},lt={class:"qr-scan-frame mt-4"},rt={key:0,class:"qr-scan-placeholder"},at={key:0,class:"mt-3 text-xs text-red-600"},ot={class:"mt-4 flex flex-wrap gap-2"},it={key:0,class:"mt-5 space-y-3"},dt={class:"rounded-3xl border border-sidebar-border/60 bg-background/60 p-5"},ut={key:0,class:"space-y-3"},ct={key:1,class:"space-y-4"},pt={key:0,class:"rounded-2xl border border-red-200 bg-red-50 px-4 py-3 text-xs text-red-700 dark:border-red-500/30 dark:bg-red-500/10 dark:text-red-200"},mt={class:"mt-2 list-disc pl-4"},ft={key:1,class:"rounded-3xl border border-sidebar-border/60 bg-background/60 p-5"},gt={key:0,class:"mt-4 rounded-2xl border border-red-200 bg-red-50 px-4 py-3 text-xs text-red-700 dark:border-red-500/30 dark:bg-red-500/10 dark:text-red-200"},yt={class:"mt-2 list-disc pl-4"},kt=te({__name:"TicketEnrollment",props:{mode:{},record:{},prefillId:{},natureOfRequests:{},referenceOptions:{}},setup(j){const o=j,b=q(()=>o.record),P=q(()=>[{title:"Inventory",href:"/inventory"},{title:o.mode==="edit"?"Edit Enrollment":"Ticket Enrollment",href:"/admin/enrollments/create"}]),n=o.prefillId??"",V=!!n,y=h(o.mode==="edit"||V?"form":"scan"),k=h(o.record?.uniqueId??n),A=h(""),f=h(""),M=h(!1),w=h(null),D=h(null),l=h(o.natureOfRequests??[]),t=h(o.referenceOptions??{status:[],category:[],officeDesignation:[],remarks:[]});let s=null,v=null;const g=q(()=>o.mode==="edit"),Q=q(()=>g.value||!!k.value),G=q(()=>Object.keys(c.errors).length>0),z=q(()=>Object.values(c.errors)),c=de({uniqueId:o.record?.uniqueId??o.prefillId??"",equipmentName:o.record?.equipmentName??"",equipmentType:o.record?.equipmentType??"",brand:o.record?.brand??"",model:o.record?.model??"",serialNumber:o.record?.serialNumber??"",assetTag:o.record?.assetTag??"",supplier:o.record?.supplier??"",purchaseDate:o.record?.purchaseDate??"",expiryDate:o.record?.expiryDate??"",warrantyStatus:o.record?.warrantyStatus??"",equipmentImageUrls:o.record?.equipmentImageUrls??[],equipmentImages:[],specification:{memory:o.record?.specification?.memory??"",storage:o.record?.specification?.storage??"",operatingSystem:o.record?.specification?.operatingSystem??"",networkAddress:o.record?.specification?.networkAddress??"",accessories:o.record?.specification?.accessories??""},locationAssignment:{assignedTo:o.record?.locationAssignment?.assignedTo??"",officeDivision:o.record?.locationAssignment?.officeDivision??"",dateIssued:o.record?.locationAssignment?.dateIssued??""},requestHistory:{natureOfRequest:o.record?.requestHistory?.natureOfRequest??"",date:o.record?.requestHistory?.date??"",actionTaken:o.record?.requestHistory?.actionTaken??"",assignedStaff:o.record?.requestHistory?.assignedStaff??"",remarks:o.record?.requestHistory?.remarks??""},scheduledMaintenance:{date:o.record?.scheduledMaintenance?.date??"",remarks:o.record?.scheduledMaintenance?.remarks??""},sections:{specification:o.record?.sections?.specification??!1,locationAssignment:o.record?.sections?.locationAssignment??!1,requestHistory:o.record?.sections?.requestHistory??!1,scheduledMaintenance:o.record?.sections?.scheduledMaintenance??!1}});ue(()=>{if(V&&!/^MIS-UID-\d{5}$/.test(n)){f.value="Unique ID must match MIS-UID-00000 format.",y.value="scan";return}y.value==="scan"&&ce(()=>{K()}),O(),s=setInterval(O,3e4),window.addEventListener("focus",O),L(),v=setInterval(L,3e4),window.addEventListener("focus",L)}),pe(()=>{E(),s&&clearInterval(s),v&&clearInterval(v),window.removeEventListener("focus",O),window.removeEventListener("focus",L)});function J(a){const r=a.match(/MIS-UID-\d{5}/i);return r?r[0].toUpperCase():a.trim().toUpperCase()}async function se(a){const r=await fetch(`/admin/qr-generator/validate/${encodeURIComponent(a)}`,{headers:{Accept:"application/json"},credentials:"same-origin"});if(!r.ok)throw new Error(`Validation failed (${r.status})`);return!!(await r.json()).valid}const ne=[{video:{facingMode:{ideal:"environment"},width:{ideal:1280},height:{ideal:720}},audio:!1},{video:{facingMode:"environment"},audio:!1},{video:{facingMode:"user"},audio:!1},{video:!0,audio:!1}];async function K(){if(f.value="",typeof window>"u"){f.value="Camera access is unavailable in this environment.";return}if(!navigator.mediaDevices?.getUserMedia){f.value="Camera access is unavailable in this browser. Enter the ID manually.";return}if(!D.value){f.value="Camera feed is unavailable.";return}const a=(r,m)=>{if(M.value){if(r){X(J(r.getText()));return}m&&m.name!=="NotFoundException"&&(f.value="Unable to read the QR code. Try again.",console.error(m))}};try{M.value=!0;const r=new be(void 0,{delayBetweenScanAttempts:200});for(const m of ne)try{w.value=await r.decodeFromConstraints(m,D.value,a);return}catch{w.value&&(w.value.stop(),w.value=null);continue}f.value="Unable to access the camera. Check permissions and try again.",M.value=!1}catch(r){f.value="Unable to access the camera. Check permissions and try again.",console.error(r),M.value=!1}}async function O(){try{const a=await fetch("/nature-of-request/options",{headers:{Accept:"application/json"},credentials:"same-origin"});if(!a.ok)return;const r=await a.json();l.value=r}catch(a){console.error(a)}}async function L(){try{const a=await fetch("/reference-values/options",{headers:{Accept:"application/json"},credentials:"same-origin"});if(!a.ok)return;const r=await a.json();t.value=r}catch(a){console.error(a)}}function E(){M.value=!1,w.value&&(w.value.stop(),w.value=null),D.value?.srcObject&&(D.value.srcObject.getTracks().forEach(r=>r.stop()),D.value.srcObject=null)}async function X(a){if(f.value="",!a){f.value="Enter or scan a valid Unique ID.";return}if(!/^MIS-UID-\d{5}$/.test(a)){f.value="Unique ID must match MIS-UID-00000 format.";return}E();try{if(!await se(a)){f.value="Invalid UID: This QR code was not generated by the system.";return}const m=await fetch(`/inventory/lookup/${encodeURIComponent(a)}`,{headers:{Accept:"application/json"},credentials:"same-origin"});if(m.redirected){window.location.assign(m.url);return}if(!m.ok)throw new Error(`Lookup failed (${m.status})`);if(!(m.headers.get("content-type")??"").includes("application/json"))throw new Error("Lookup response was not JSON");const W=await m.json();if(W.exists&&W.redirect){window.location.assign(W.redirect);return}ye.get("/admin/enrollments/create",{unique_id:a},{replace:!0})}catch(r){f.value="Unable to verify this Unique ID. Please try again.",console.error(r)}}function le(){E(),y.value="manual",A.value=k.value}function re(){X(J(A.value))}function ae(){k.value="",A.value="",y.value="scan",K()}function Y(a){c.clearErrors(),c.uniqueId=a.uniqueId,c.equipmentName=a.equipmentName,c.equipmentType=a.equipmentType,c.brand=a.brand,c.model=a.model,c.serialNumber=a.serialNumber,c.assetTag=a.assetTag,c.supplier=a.supplier,c.purchaseDate=a.purchaseDate,c.expiryDate=a.expiryDate,c.warrantyStatus=a.warrantyStatus,c.equipmentImageUrls=a.equipmentImageUrls,c.equipmentImages=a.equipmentImages,c.specification=a.specification,c.locationAssignment=a.locationAssignment,c.requestHistory=a.requestHistory,c.scheduledMaintenance=a.scheduledMaintenance,c.sections=a.sections,g.value?c.put(`/admin/enrollments/${encodeURIComponent(a.uniqueId)}`):c.post("/admin/enrollments")}return(a,r)=>(i(),d(U,null,[S(F(me),{title:g.value?"Edit Enrollment":"Ticket Enrollment"},null,8,["title"]),S(ve,{breadcrumbs:P.value},{default:H(()=>[e("div",Ge,[e("section",ze,[e("div",Je,[e("div",Ke,[r[1]||(r[1]=e("p",{class:"text-xs uppercase tracking-[0.3em] text-muted-foreground"}," Inventory System ",-1)),e("h1",Xe,I(g.value?"Edit equipment enrollment":"Ticket enrollment"),1),r[2]||(r[2]=e("p",{class:"text-sm text-muted-foreground"}," Capture asset identification, optional specifications, and assignment details in a single, organized workflow. ",-1))]),e("div",Ye,[S(F(_),{href:"/inventory",class:"rounded-full border border-sidebar-border/70 px-4 py-2 text-sm font-semibold text-muted-foreground transition-colors hover:bg-muted/40"},{default:H(()=>[...r[3]||(r[3]=[$(" Back to Inventory ",-1)])]),_:1}),g.value?x("",!0):(i(),fe(F(_),{key:0,href:"/admin/qr-generator",class:"rounded-full bg-[#1e293b] px-4 py-2 text-sm font-semibold text-white transition-colors hover:bg-[#0f172a]"},{default:H(()=>[...r[4]||(r[4]=[$(" Generate QR IDs ",-1)])]),_:1}))])])]),g.value?(i(),d("section",ft,[S(ee,{"scanned-id":k.value,"readonly-id":Q.value,initial:b.value,"nature-options":l.value,"reference-options":t.value,onSubmit:Y},null,8,["scanned-id","readonly-id","initial","nature-options","reference-options"]),G.value?(i(),d("div",gt,[r[11]||(r[11]=e("p",{class:"text-sm font-semibold"},"Please review the highlighted fields.",-1)),e("ul",yt,[(i(!0),d(U,null,T(z.value,(m,N)=>(i(),d("li",{key:`error-edit-${N}`},I(m),1))),128))])])):x("",!0)])):(i(),d("div",Ze,[e("section",_e,[r[8]||(r[8]=e("div",{class:"space-y-3"},[e("h2",{class:"text-sm font-semibold uppercase tracking-[0.2em] text-muted-foreground"}," Step 1 "),e("p",{class:"text-base font-semibold"},"Scan or enter the Unique ID"),e("p",{class:"text-sm text-muted-foreground"}," The system checks the Inventory database first. If the asset already exists, you will be routed to its details page. ")],-1)),e("div",et,[e("div",tt,[r[5]||(r[5]=e("p",{class:"text-sm font-semibold"},"QR scanner",-1)),y.value==="scan"?(i(),d("span",st," Live ")):(i(),d("span",nt," Paused "))]),e("div",lt,[u(e("video",{ref_key:"videoRef",ref:D,class:"qr-scan-video",autoplay:"",muted:"",playsinline:""},null,512),[[ge,y.value==="scan"]]),y.value!=="scan"?(i(),d("div",rt,[...r[6]||(r[6]=[e("p",{class:"text-sm font-semibold text-slate-600"}," Ready to scan ",-1),e("p",{class:"mt-1 text-xs text-slate-500"}," Tap rescan to open the camera again. ",-1)])])):x("",!0)]),f.value?(i(),d("p",at,I(f.value),1)):x("",!0),e("div",ot,[y.value==="scan"?(i(),d("button",{key:0,type:"button",class:"rounded-full border border-[#0f172a]/20 px-3 py-1.5 text-xs font-semibold text-[#0f172a] transition-colors hover:bg-[#0f172a]/5 dark:text-white dark:hover:bg-white/10",onClick:le}," Enter ID manually ")):x("",!0),y.value==="scan"?(i(),d("button",{key:1,type:"button",class:"rounded-full border border-[#0f172a]/20 px-3 py-1.5 text-xs font-semibold text-[#0f172a] transition-colors hover:bg-[#0f172a]/5 dark:text-white dark:hover:bg-white/10",onClick:E}," Stop camera ")):(i(),d("button",{key:2,type:"button",class:"rounded-full border border-[#0f172a]/20 px-3 py-1.5 text-xs font-semibold text-[#0f172a] transition-colors hover:bg-[#0f172a]/5 dark:text-white dark:hover:bg-white/10",onClick:ae}," Rescan "))])]),y.value==="manual"?(i(),d("div",it,[r[7]||(r[7]=e("label",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-muted-foreground"}," Manual entry ",-1)),u(e("input",{"onUpdate:modelValue":r[0]||(r[0]=m=>A.value=m),type:"text",class:"w-full rounded-2xl border border-sidebar-border/70 bg-background px-4 py-3 text-sm",placeholder:"MIS-UID-00000"},null,512),[[p,A.value]]),e("button",{type:"button",class:"w-full rounded-full bg-[#0f172a] px-4 py-2.5 text-sm font-semibold text-white transition-colors hover:bg-[#1e293b]",onClick:re}," Continue ")])):x("",!0)]),e("section",dt,[y.value!=="form"?(i(),d("div",ut,[...r[9]||(r[9]=[e("h3",{class:"text-base font-semibold"},"Awaiting Unique ID",-1),e("p",{class:"text-sm text-muted-foreground"}," Scan a QR code or enter the ID manually to unlock the enrollment form. ",-1),e("div",{class:"rounded-2xl border border-dashed border-sidebar-border/70 p-6 text-sm text-muted-foreground"}," The enrollment form will appear here once an unregistered ID is found. ",-1)])])):(i(),d("div",ct,[S(ee,{"scanned-id":k.value,"readonly-id":Q.value,initial:b.value,"nature-options":l.value,"reference-options":t.value,onSubmit:Y},null,8,["scanned-id","readonly-id","initial","nature-options","reference-options"]),G.value?(i(),d("div",pt,[r[10]||(r[10]=e("p",{class:"text-sm font-semibold"},"Please review the highlighted fields.",-1)),e("ul",mt,[(i(!0),d(U,null,T(z.value,(m,N)=>(i(),d("li",{key:`error-${N}`},I(m),1))),128))])])):x("",!0)]))])]))])]),_:1},8,["breadcrumbs"])],64))}});export{kt as default};
